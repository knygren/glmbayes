#!/bin/bash

CL_HEADER=$(find /usr /usr/local /opt -type f -name cl.h 2>/dev/null | grep "/CL/cl.h" | head -n 1)

if [ -n "$CL_HEADER" ]; then
  CL_BASE=$(dirname "$CL_HEADER")
  echo "Found OpenCL header at $CL_BASE"
  {
    echo "PKG_CXXFLAGS = \$(SHLIB_OPENMP_CXXFLAGS) -DUSE_OPENCL -I$CL_BASE"
    echo "PKG_LIBS = \$(SHLIB_OPENMP_CXXFLAGS) -L$CL_BASE/../lib64 -lOpenCL -ltbb \$(LAPACK_LIBS) \$(BLAS_LIBS) \$(FLIBS)"
  } > src/Makevars
else
  echo "OpenCL header not found. Building without OpenCL..."
  {
    echo "PKG_CXXFLAGS = \$(SHLIB_OPENMP_CXXFLAGS)"
    echo "PKG_LIBS = \$(SHLIB_OPENMP_CXXFLAGS) -ltbb \$(LAPACK_LIBS) \$(BLAS_LIBS) \$(FLIBS)"
  } > src/Makevars
fi
