<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • glmbayes</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">glmbayes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/chapter-01.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-02.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-03.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-04.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-05.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-06.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-07.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-08.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-09.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-10.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-11.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-A1.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-A2.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Chapter 2: Specifying Multivariate Normal Priors
and Interpreting Model Outputs</h1>
                        <h4 data-toc-skip class="author">Kjell
Nygren</h4>
            
            <h4 data-toc-skip class="date">2025-07-14</h4>
      

      <div class="hidden name"><code>Chapter-02.Rmd</code></div>

    </div>

    
    
<p>Yaml</p>
<pre><code><span><span class="co">#&gt; Loading required package: MASS</span></span></code></pre>
<div class="section level2">
<h2 id="general-discussion">General Discussion<a class="anchor" aria-label="anchor" href="#general-discussion"></a>
</h2>
<p>As we saw in the previous chapter, using the Bayesian version
<em>glmb</em> of the classical function <em>glm</em> requires the
specification of an additional prior distribution (a pfamily). For
Poisson and Binomial families, the most appropriate of the currently
implemented priors would be the dNormal pfamily which requires
specifying a prior mean and a prior variance-covariance matrix for the
regression coefficients. Some models (covered more in a later Vignette)
also requires providing either a constant or a prior for the dispersion
(variance) parameter associated with the model. Here we focus on the
case where only the regression coefficients require a prior and walk
through an example where we specify a multivariate prior for a model
with two coeffcients related to the Age of menarche (i.e., the age at
which girls experience their first period). As part of the setup, we
discuss the approach taken and give some general advice in regards to
setting of prior distributions.</p>
</div>
<div class="section level2">
<h2 id="the-age-of-menarche-data">The Age of Menarche Data<a class="anchor" aria-label="anchor" href="#the-age-of-menarche-data"></a>
</h2>
<p>The data we will be using here is the <em>menarche2</em> data
covering the <em>Age of Menarche</em> for girls in Warsaw. This data
appears in <span class="citation">(Venables and Ripley 2002)</span> and
in their supporting <em>MASS</em> package. It is provided (and renamed)
here so as to allow examples to run during build without loading of the
<em>MASS</em> package.</p>
<p>In the data, there are observations related to 25 cohorts of girls at
ages ranging from an average age of 9.21 to an average age of 17.58. The
average age for each cohort is captured in a column named <em>Age</em>.
For each of the cohorts, there is also a column (<em>Total</em>) giving
the total number of girls in the cohort and a column <em>Menarche</em>
giving the number of girls out of the cohort who had experienced
Menarche at that age.</p>
<p>The first 5 observations are printed below. It is important to note
that in Bayesian analyses (at least those that seek to incorporate
prior/external information), the priors should ideally be based on
information outside of the data being studied, so we will hold off on a
more complete view of the data until we have mapped out our prior. The
analysis we will be exploring here is a model of the relationship
between age and the percentage of girls who have had their first period
using various formulations of binomial regression.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load menarche data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">menarche2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">menarche2</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Age Total Menarche</span></span>
<span><span class="co">#&gt; 1  9.21   376        0</span></span>
<span><span class="co">#&gt; 2 10.21   200        0</span></span>
<span><span class="co">#&gt; 3 10.58    93        0</span></span>
<span><span class="co">#&gt; 4 10.83   120        2</span></span>
<span><span class="co">#&gt; 5 11.08    90        2</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="variable-transformation-and-preliminary-setup">Variable Transformation and Preliminary Setup<a class="anchor" aria-label="anchor" href="#variable-transformation-and-preliminary-setup"></a>
</h2>
<p>Because of the need for a prior distribution, it is important that
coefficients in Bayesian models can be interpreted so that analysts can
set reasonable priors. This is true regardless of whether analysts are
looking to give a model a <em>weak</em> prior (that will limit any move
of the estimates away from those driven purely by the data for that
specific model) or if the analyst is looking to give the model a
<em>strong</em> prior that incorporates meaningful external information
and/or prior knowledge. If the analysts can’t interpret the
coefficients, then is is difficult to know whether a prior distribution
is <em>weak</em> or <em>strong</em> and whether it is likely to move
estimates meaningfully away from classical estimates.</p>
<p>A useful approach to making coefficients more interpretable involves
centering variables closer to the center (or at least within the support
of) the data. To facilitate the interpretation of the coefficients in
our model, we will therefore pick a reference age <em>ref_age1</em>
within the support of the data (we pick 13 but you can feel free to pick
a different reference age or to use the mean across the observations)
and define a new variable <em>Age2=Age-ref_age1</em>. This will allow
our prior for the intercept to represent a point estimate (on the chosen
link function scale) for the percentage of girls who have had their
first period by age 13. It also happens to be an age close to the
average age of menarche in other sources <span class="citation">(Hamilton-Fairley 2004, 29)</span> which reported the
UK average age of menarche in the UK as 12.9.</p>
<p>In addition to the intercept, our model will contain a slope
coefficient for the modified age variable that will capture the change
in the percentage of girls who have had their first period (on the
relevant link scale). To be able to formulate a prior for this, we will
set up a second reference age <em>ref_age2</em> (our choice will be 15)
at which we also will formulate a point estimate for the percentage who
have had their first period. A point estimate for the slope on the link
scale will then be derived as the difference between the two estimates
(on the link scale) divided by the Age gap between the two reference
ages. Below is code doing the variable transformation and a preliminary
setup to prepare for the prior specification.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Number of variables in model</span></span>
<span><span class="va">Age</span><span class="op">=</span><span class="va">menarche2</span><span class="op">$</span><span class="va">Age</span></span>
<span><span class="va">nvars</span><span class="op">=</span><span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Reference Ages for setting of priors and Age_Difference</span></span>
<span><span class="va">ref_age1</span><span class="op">=</span><span class="fl">13</span>  <span class="co"># user can modify this</span></span>
<span><span class="va">ref_age2</span><span class="op">=</span><span class="fl">15</span>  <span class="co">## user can modify this</span></span>
<span></span>
<span><span class="co">## Define variables used later in analysis</span></span>
<span><span class="va">Age2</span><span class="op">=</span><span class="va">Age</span><span class="op">-</span><span class="va">ref_age1</span></span>
<span><span class="va">Age_Diff</span><span class="op">=</span><span class="va">ref_age2</span><span class="op">-</span><span class="va">ref_age1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-prior-point-estimates-associated-credible-intervals-and-correlation">Setting prior point estimates, associated credible intervals, and
correlation<a class="anchor" aria-label="anchor" href="#setting-prior-point-estimates-associated-credible-intervals-and-correlation"></a>
</h2>
<p>We are now ready to specify our two point estimates with associated
prior credible intervals and an assumed correlation (on the link scale).
For the first reference age (13), we will provide a point estimate of
0.5 (50%) for the percentage of girls who have had their first period by
age 13. To account for the possibility that this percentage was a bit
lower in Warsaw at the time data was collected, we will assume that the
lower end of a 90% credible interval is at 0.3 (30%).</p>
<p>For the second reference age (15), we have not accessed as much
meaningful data from other sources to inform the prior estimate, but we
have a general sense that <em>“most”</em> girls likely have had their
period by that age. Based on this, we select 0.9 (90%) as a prior point
estimate and select 0.7 (70%) as the lower end of our associated
credible interval.</p>
<p>To complete the information needed to map this information to both
prior means and a fully populated Variance-Covariance matrix, we account
for the likely correlation between the percentage at the two ages. If
one of our two point estimates turn out to be either too high (or low)
for the Warsaw data, it is likely that the other estimate also could be
too high (or low) for the data as well. To that end, we assume a prior
0.4 correlation between the two estimates on the relevant link
scale.</p>
<p>Here is code setting these assumptions up.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Point estimates at reference ages</span></span>
<span><span class="va">m1</span><span class="op">=</span><span class="fl">0.5</span>  </span>
<span><span class="va">m2</span><span class="op">=</span><span class="fl">0.9</span></span>
<span></span>
<span><span class="co">## Lower bound of prior credible intervals for point estimates</span></span>
<span><span class="va">m1_lower</span><span class="op">=</span><span class="fl">0.3</span></span>
<span><span class="va">m2_lower</span><span class="op">=</span><span class="fl">0.7</span></span>
<span></span>
<span><span class="co">## Assumed correlation between the two (on link scale)</span></span>
<span><span class="va">m_corr</span><span class="op">=</span><span class="fl">0.4</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mapping-the-prior-to-the-link-scale">Mapping the prior to the link scale<a class="anchor" aria-label="anchor" href="#mapping-the-prior-to-the-link-scale"></a>
</h2>
<p>To be able to use the prior information in our model, the information
has to be mapped to the link scale and the point estimates (with
associated credible intervals) have to be mapped to a point estimate and
uncertainty for the slope. In order to do this, we first get the
required link function and set up the matrices into which we will store
the prior information (<em>mu1</em> and <em>V1</em>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Set up link function and initialize prior mean and Variance-Covariance matrices</span></span>
<span><span class="va">bi_logit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span></span>
<span><span class="va">mu1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,nrow<span class="op">=</span><span class="va">nvars</span>,ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mu1</span><span class="op">)</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>,<span class="st">"Age2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mu1</span><span class="op">)</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prior Mean"</span><span class="op">)</span></span>
<span><span class="va">V1</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">nvars</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">V1</span><span class="op">)</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>,<span class="st">"Age2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">V1</span><span class="op">)</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>,<span class="st">"Age2"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Setting the prior mean</strong></p>
<p>This piece of code now maps the prior assumptions to the logit scale
and sets the prior mean vector. The mean for the intercept is just the
logit transformation of the prior point estimate while the mean for the
slope uses the difference between the logit transformed point estimates
divided by the Age_Difference.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Prior mean for intercept is set to point estimate </span></span>
<span><span class="co">## at reference age1 (on logit scale)</span></span>
<span><span class="va">mu1</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="va">bi_logit</span><span class="op">$</span><span class="fu">linkfun</span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Prior mean for slope is set to difference in point estimates</span></span>
<span><span class="co">## on logit scale divided by Age_Diff</span></span>
<span></span>
<span><span class="va">mu1</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="op">(</span><span class="va">bi_logit</span><span class="op">$</span><span class="fu">linkfun</span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="op">-</span><span class="va">bi_logit</span><span class="op">$</span><span class="fu">linkfun</span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">Age_Diff</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mu1</span><span class="op">)</span></span>
<span><span class="co">#&gt;           Prior Mean</span></span>
<span><span class="co">#&gt; Intercept   0.000000</span></span>
<span><span class="co">#&gt; Age2        1.098612</span></span></code></pre></div>
<p><strong>Setting the prior Variance-Covariance Matrix</strong></p>
<p>The piece of code setting the prior variance-covariance matrix for
this prior specification is a bit more complex. It proceeds as
follows:</p>
<ul>
<li>Calculate the prior standard deviation for each of the point
estimates by leveraging the lower bounds</li>
<li>Calculate the implied standard deviation for the slope using the
formula for the variance of differences</li>
<li>Calculate the implied covariance between the intercept and the
slope</li>
<li>Populate the Prior Variance-Covariance matrix using the derived
information</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Implied standard deviations for point estimates on logit scale</span></span>
<span></span>
<span><span class="va">sd_m1</span><span class="op">=</span> <span class="op">(</span><span class="va">bi_logit</span><span class="op">$</span><span class="fu">linkfun</span><span class="op">(</span><span class="va">m1</span><span class="op">)</span> <span class="op">-</span><span class="va">bi_logit</span><span class="op">$</span><span class="fu">linkfun</span><span class="op">(</span><span class="va">m1_lower</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">1.96</span></span>
<span><span class="va">sd_m2</span><span class="op">=</span> <span class="op">(</span><span class="va">bi_logit</span><span class="op">$</span><span class="fu">linkfun</span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="op">-</span><span class="va">bi_logit</span><span class="op">$</span><span class="fu">linkfun</span><span class="op">(</span><span class="va">m2_lower</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">1.96</span></span>
<span></span>
<span><span class="co">## Also compute implied estimate for upper bound of confidence intervals</span></span>
<span></span>
<span><span class="va">m1_upper</span><span class="op">=</span><span class="va">bi_logit</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">bi_logit</span><span class="op">$</span><span class="fu">linkfun</span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">+</span><span class="va">sd_m1</span><span class="op">*</span><span class="fl">1.96</span><span class="op">)</span></span>
<span><span class="va">m2_upper</span><span class="op">=</span><span class="va">bi_logit</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">bi_logit</span><span class="op">$</span><span class="fu">linkfun</span><span class="op">(</span><span class="va">m2</span><span class="op">)</span><span class="op">+</span><span class="va">sd_m2</span><span class="op">*</span><span class="fl">1.96</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"m1_upper is:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "m1_upper is:"</span></span>
<span><span class="va">m1_upper</span></span>
<span><span class="co">#&gt; [1] 0.7</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"m2_upper is:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "m2_upper is:"</span></span>
<span><span class="va">m2_upper</span></span>
<span><span class="co">#&gt; [1] 0.972</span></span>
<span></span>
<span></span>
<span><span class="co">## Implied Standard deviation for slope (using variance formula for difference between two variables)</span></span>
<span><span class="va">a</span><span class="op">=</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">Age_Diff</span><span class="op">)</span></span>
<span><span class="va">sd_slope</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">a</span><span class="op">*</span><span class="va">sd_m1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">+</span><span class="op">(</span><span class="va">a</span><span class="op">*</span><span class="va">sd_m2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">a</span><span class="op">*</span><span class="va">a</span><span class="op">*</span><span class="op">(</span><span class="va">sd_m1</span><span class="op">*</span><span class="va">sd_m2</span><span class="op">*</span><span class="va">m_corr</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Cov(m1,slope)=cov(m1, a*(m2-m1)) =a*E[(m1-E[m1])((m2-m1)-E[m2-m1])]</span></span>
<span><span class="co">#   =a*E[(m1-E[m1])(m2-E[m2])]- a* E[(m1-E[m1])(m1-E[m1])]</span></span>
<span><span class="co">##   =a*Cov[m1,m2] - a*Var[m1]</span></span>
<span><span class="co">##  =a*sd_m1*sd_m2*m_corr-a* sd_m1*sd_m1</span></span>
<span><span class="va">cov_V1</span><span class="op">=</span><span class="va">a</span><span class="op">*</span><span class="va">sd_m1</span><span class="op">*</span><span class="va">sd_m2</span><span class="op">*</span><span class="va">m_corr</span><span class="op">-</span><span class="va">a</span><span class="op">*</span> <span class="va">sd_m1</span><span class="op">*</span><span class="va">sd_m1</span></span>
<span></span>
<span><span class="co"># Set covariance matrix</span></span>
<span><span class="va">V1</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="va">sd_m1</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">V1</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">=</span><span class="va">sd_slope</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">V1</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">=</span><span class="va">cov_V1</span></span>
<span><span class="va">V1</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="va">V1</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"V1 is:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "V1 is:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">V1</span><span class="op">)</span></span>
<span><span class="co">#&gt;             Intercept        Age2</span></span>
<span><span class="co">#&gt; Intercept  0.18687882 -0.03389182</span></span>
<span><span class="co">#&gt; Age2      -0.03389182  0.10576217</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-the-model">Running the Model<a class="anchor" aria-label="anchor" href="#running-the-model"></a>
</h2>
<p>We are now ready to run a Logit model using the above specification.
As a best practice, we recommend creating a data frame holding all the
variables used in the model formula and to use it as the “data” for the
model. We will show how this data can be used an an input to the
prediction function in the next Chapter.</p>
<p>The below code performs the step creating the Model data frame and
then submits the model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Menarche_Model_Data</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Age<span class="op">=</span><span class="va">menarche2</span><span class="op">$</span><span class="va">Age</span>,Total<span class="op">=</span><span class="va">menarche2</span><span class="op">$</span><span class="va">Total</span>,</span>
<span>Menarche<span class="op">=</span><span class="va">menarche2</span><span class="op">$</span><span class="va">Menarche</span>,<span class="va">Age2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glmb.out1</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/glmb.html">glmb</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">10000</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Menarche</span>, <span class="va">Total</span><span class="op">-</span><span class="va">Menarche</span><span class="op">)</span> <span class="op">~</span><span class="va">Age2</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="va">logit</span><span class="op">)</span>,</span>
<span>pfamily<span class="op">=</span><span class="fu"><a href="../reference/pfamily.html">dNormal</a></span><span class="op">(</span>mu<span class="op">=</span><span class="va">mu1</span>,Sigma<span class="op">=</span><span class="va">V1</span><span class="op">)</span>,data<span class="op">=</span><span class="va">Menarche_Model_Data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in eval(family$initialize): non-integer #successes in a binomial glm!</span></span></code></pre></div>
<p><strong>Reviewing the printed output</strong></p>
<p>To get a first read of the results, we now print the results of the
model and re-print the prior mean specification so that we can do an
initial comparison of the prior to the estimated posterior means.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Print model output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">glmb.out1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:  glmb(formula = cbind(Menarche, Total - Menarche) ~ Age2, family = binomial(logit), </span></span>
<span><span class="co">#&gt;     pfamily = dNormal(mu = mu1, Sigma = V1), n = 10000, data = Menarche_Model_Data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Posterior Mean Coefficients:</span></span>
<span><span class="co">#&gt; (Intercept)         Age2  </span></span>
<span><span class="co">#&gt;    -0.01262      1.61771  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Effective Number of Parameters: 1.944884 </span></span>
<span><span class="co">#&gt; Expected Residual Deviance: 28.70857 </span></span>
<span><span class="co">#&gt; DIC: 114.7053</span></span>
<span></span>
<span><span class="co"># Print prior mean as comparison</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mu1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            Intercept     Age2</span></span>
<span><span class="co">#&gt; Prior Mean         0 1.098612</span></span></code></pre></div>
<p>In reviewing the coefficients, we see that the intercepts look quite
close, so our prior estimate at age 13 does not seem to have been a bad
estimate for what the Warsaw data suggests. Our prior estimate for the
slope parameter seems to be a bit lower than the posterior mean estimate
but without information on the standard error or credible intervals
connected to the posterior mean, we can’t tell how off it might have
been. We ignore the other printed output for now (it will be discussed
in the next chapter) and instead turn to a more extensive model
summary.</p>
<p><strong>Summarizing the model</strong></p>
<p>To get a more detailed view of the model output, we simply use the
summary function and its print method much like you would to generate a
summary for output from the <em>glm</em> function. This results in a
printed view with several sections of outputs</p>
<ul>
<li>Expected Deviance Residuals (Discussed more in the next
Chapter)</li>
<li>Prior and Maximum Likelihood Estimates with Standard Deviations</li>
<li>Bayesian Estimates Based on iid draws from the posterior (in this
case 1000 draws)</li>
<li>Distribution Percentiles (Credible Interval type information)</li>
<li>DIC related information (Discussed more in the next chapter)</li>
<li>Information related to the number of candidates per iid draw
(discussed more in one of our Appendix chapters)</li>
</ul>
<p>We discuss several of these after the print view of the output from
the call to the summary function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">glmb.out1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call</span></span>
<span><span class="co">#&gt; glmb(formula = cbind(Menarche, Total - Menarche) ~ Age2, family = binomial(logit), </span></span>
<span><span class="co">#&gt;     pfamily = dNormal(mu = mu1, Sigma = V1), n = 10000, data = Menarche_Model_Data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Expected Deviance Residuals:</span></span>
<span><span class="co">#&gt;        1        2        3        4        5        6        7        8 </span></span>
<span><span class="co">#&gt; -1.27810 -2.08273 -1.90995 -0.85900 -1.04451 -0.21412  0.17020  0.72053 </span></span>
<span><span class="co">#&gt;        9       10       11       12       13       14       15       16 </span></span>
<span><span class="co">#&gt; -0.58987  1.33264  1.18069  0.91273 -1.08342  0.09983  1.28483 -1.00581 </span></span>
<span><span class="co">#&gt;       17       18       19       20       21       22       23       24 </span></span>
<span><span class="co">#&gt; -1.16985  1.12655  0.63816 -0.82212 -0.41840 -0.85490 -0.43679 -0.69131 </span></span>
<span><span class="co">#&gt;       25 </span></span>
<span><span class="co">#&gt;  1.14438 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prior and Maximum Likelihood Estimates with Standard Deviations</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           Prior Mean Prior.sd Max Like. Like.sd</span></span>
<span><span class="co">#&gt; Intercept    0.00000  0.43229  -0.01081   0.063</span></span>
<span><span class="co">#&gt; Age2         1.09861  0.32521   1.63197   0.059</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bayesian Estimates Based on 10000 iid draws</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Post.Mode Post.Mean  Post.Sd MC Error Pr(tail)    </span></span>
<span><span class="co">#&gt; (Intercept)  -0.01369  -0.01262  0.06226        0    0.417    </span></span>
<span><span class="co">#&gt; Age2          1.61438   1.61771  0.05720        0    1e-04 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Distribution Percentiles</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 1.0%     2.5%     5.0%   Median    95.0%    97.5% 99.0%</span></span>
<span><span class="co">#&gt; (Intercept) -0.15849 -0.13447 -0.11362 -0.01247  0.09128  0.11098 0.135</span></span>
<span><span class="co">#&gt; Age2         1.48780  1.50781  1.52469  1.61679  1.71265  1.73376 1.756</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Effective Number of Parameters: 1.944884 </span></span>
<span><span class="co">#&gt; Expected Residual Deviance: 28.70857 </span></span>
<span><span class="co">#&gt; DIC: 114.7053 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Expected Mean dispersion: 1 </span></span>
<span><span class="co">#&gt; Sq.root of Expected Mean dispersion: 1 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mean Likelihood Subgradient Candidates Per iid sample: 1.2599</span></span></code></pre></div>
<p><em>Interpreting the “Prior and Maximum Likelihood Estimates with
Standard Deviations” table</em></p>
<p>This table gives a side-by-side comparison of the prior and the data
driven maximum likelihood estimates (that should match the ouput from
the glm function for the same model). In addition to revealing any
differences in the estimates themselves, the relative magnitude of the
standard deviations give insight into how “strong” the prior
specification is relative to the information contained in the data. The
unstandardized weights on the prior and data respectively are in most
cases likely to be close to <em>(1/sd_prior)^2</em> and
<em>(1/sd_data)^2</em> respectively. The fact that the prior standard
deviations are much larger in this case tells us that the posterior mean
estimates are likely to be much closer to the maximum likelihood
estimates than to the prior estimates.</p>
<p><em>Interpreting the “Bayesian Estimates Based on 1000 iid draws
table</em></p>
<p>This table gives more information related to the estimates seen in
the print output. We now have a view of both the posterior mode and
posterior mean. If these were substantially different, it would indicate
that the posterior density had substantial asymmetry. The posterior
standard deviation will generally be smaller than both the prior and the
likelihood standard deviations. In this case, the posterior standard
deviation for the <em>intercept</em> appears to be nearly the same as
the likelihood standard deviation while the posterior standard deviation
for <em>Age2</em> is substantially smaller (suggesting some weight on
the prior).</p>
<p>The tail probability gives the probability (under the posterior
density) of the true coefficient being at least as far away from the
center as the prior point estimate. In this case, there is ~44%
probability of the intercept being greater than 0 but only a ~0.01%
chance that the Age2 coefficient is smaller than the prior point
estimate of 1.098. The latter is flagged as highly significant
suggesting that the true slope coefficient is substantially larger than
the prior point estimate.</p>
<p>The MC error column gives a sense of any error in the estimates
driven by the fact that we are using monte carlo simulation to generate
our estimates. In this case, we used 1000 draws which appears to have
been enough to make this error small. The user can experiment with this
to see how the errors increase if we base the estimates on a smaller
number of draws. In general, it is not recommended to interpret model
output based on small number of draws. On the other hand, the fact that
estimates are iid draws as opposed to Markov Chain Monte Carlo outputs
eliminates any need for convergence diagnostics and burn-in phases.</p>
<p><em>Interpreting the “Distribution Percentile” table</em></p>
<p>This table providence credible interval information at several
significance levels for the model. It gives the user insight into the
range of most of the support for the posterior density and how it
compares to both the prior and maximum likelihood point estimates. In
this case, we can see that the prior point estimate for the intercept is
close to the center of the density while the prior point estimate is far
away from it.</p>
<p><em>Brief discussion of Findings from model</em></p>
<p>As we noted above, the posterior estimates for the intercept appear
broadly consistent with the prior specification, so in a sense our prior
beliefs are “validated” for the 13 year old girls. As the slope is
substantially larger than in our prior specification, however, it seems
like we underestimated the % of girls at age 15 who had already had
their first period. The percentage is apparently substantially higher
than the 90% we specificed using our prior and if we are Bayesians we
should hence update our beliefs substantially based on the data. To
understand exactly how much requires us to look at the model
predictions(in particular predictions on the inverse link scale). We
will do so in a later chapter.</p>
</div>
<div class="section level2">
<h2 id="concluding-discussion">Concluding Discussion<a class="anchor" aria-label="anchor" href="#concluding-discussion"></a>
</h2>
<p>In this note, we walked through an example illustrating a process for
setting of the prior in the case of the <em>Age of Menarche</em> model
based on the data in <span class="citation">(Venables and Ripley
2002)</span>. There are several approaches taken here the we believe
analysts can find useful in setting reasonable priors. These
include:</p>
<ul>
<li>Centering variables so that the intercept can be given a meaningful
prior and so that meaningful priors for the other variables can be
formulated based on sensitivity in the support of data</li>
<li>Incorporating external information if available (like our
information regarding the average age of Menarche in the UK)</li>
<li>Making reasonable assumptions based on other knowledge/insight
(e.g., our prior point estimate at age 15)</li>
</ul>
<p>In the next section, we will take a take a look at how the analysts
can check whether the data seems consistent with the specified
prior.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Hamilton2004" class="csl-entry">
Hamilton-Fairley, Diana. 2004. <em>Lecture Notes Obstetrics and
Gynaecology</em>. Blackwell Pub. <a href="https://www.bookdepository.com/Lecture-Notes-Obstetrics-Gynaecology-Diana-Hamilton-Fairley/9781405120661" class="external-link">https://www.bookdepository.com/Lecture-Notes-Obstetrics-Gynaecology-Diana-Hamilton-Fairley/9781405120661</a>.
</div>
<div id="ref-nygren2006" class="csl-entry">
Nygren, Kjell, and Lan Ma Nygren. 2006. <span>“Likelihood Subgradient
Densities.”</span> <em>Journal of the American Statistical
Association</em> 101 (475): 1144–56. <a href="https://doi.org/10.1198/016214506000000357" class="external-link">https://doi.org/10.1198/016214506000000357</a>.
</div>
<div id="ref-Venables2002" class="csl-entry">
Venables, W. N., and B. D. Ripley. 2002. <em>Modern Applied Statistics
with S.</em> Springer-Verlag New York. <a href="https://doi.org/10.1007/978-0-387-21706-2" class="external-link">https://doi.org/10.1007/978-0-387-21706-2</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kjell Nygren.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
