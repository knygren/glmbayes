<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>The Bayesian Generalized Linear Model Distribution in Standard Form — rnnorm_reg_std • glmbayes</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="The Bayesian Generalized Linear Model Distribution in Standard Form — rnnorm_reg_std"><meta property="og:description" content="rnnorm_reg_std is used to generate iid samplers from Non-Gaussian Generalized
Linear Models in standard form. The function should onlybe called after standardization
of a Generalized Linear Model."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">glmbayes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/chapter-01.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-02.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-03.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-04.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-05.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-06.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-07.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-08.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-09.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-10.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-11.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-A1.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-A2.html">UNKNOWN TITLE</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>The Bayesian Generalized Linear Model Distribution in Standard Form</h1>

    <div class="hidden name"><code>rnnorm_reg_std.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>rnnorm_reg_std</code> is used to generate iid samplers from Non-Gaussian Generalized
Linear Models in standard form. The function should onlybe called after standardization
of a Generalized Linear Model.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rnnorm_reg_std</span><span class="op">(</span></span>
<span>  <span class="va">n</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">mu</span>,</span>
<span>  <span class="va">P</span>,</span>
<span>  <span class="va">alpha</span>,</span>
<span>  <span class="va">wt</span>,</span>
<span>  <span class="va">f2</span>,</span>
<span>  <span class="va">Envelope</span>,</span>
<span>  <span class="va">family</span>,</span>
<span>  <span class="va">link</span>,</span>
<span>  progbar <span class="op">=</span> <span class="fl">1L</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>number of draws to generate. If <code>length(n) &gt; 1</code>, the length is taken to be the number required.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>a vector of observations of length <code>m</code>.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>a design matrix of dimension <code>m * p</code>.</p></dd>


<dt id="arg-mu">mu<a class="anchor" aria-label="anchor" href="#arg-mu"></a></dt>
<dd><p>a vector of length <code>p</code> giving the prior means of the variables in the design matrix.</p></dd>


<dt id="arg-p">P<a class="anchor" aria-label="anchor" href="#arg-p"></a></dt>
<dd><p>a positive-definite symmetric matrix of dimension <code>p * p</code> specifying the prior precision
matrix of the variable.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>this can be used to specify an <em>a priori</em> known component
to be included in the linear predictor during fitting. This should be
<code>NULL</code> or a numeric vector of length equal to the number of cases.
One or more offset terms can be included in the formula instead or as well,
and if more than one is specified their sum is used. See
<code><a href="https://rdrr.io/r/stats/model.extract.html" class="external-link">model.offset</a></code>.</p></dd>


<dt id="arg-wt">wt<a class="anchor" aria-label="anchor" href="#arg-wt"></a></dt>
<dd><p>an optional vector of ‘prior weights’ to be used in the fitting process.
Should be NULL or a numeric vector.</p></dd>


<dt id="arg-f-">f2<a class="anchor" aria-label="anchor" href="#arg-f-"></a></dt>
<dd><p>function used to calculate the negative of the log-posterior function</p></dd>


<dt id="arg-envelope">Envelope<a class="anchor" aria-label="anchor" href="#arg-envelope"></a></dt>
<dd><p>an object of type <code>glmbenvelope</code>.</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>family used for simulation. Used that this is different from the
family used in other functions.</p></dd>


<dt id="arg-link">link<a class="anchor" aria-label="anchor" href="#arg-link"></a></dt>
<dd><p>link function used for simulation.</p></dd>


<dt id="arg-progbar">progbar<a class="anchor" aria-label="anchor" href="#arg-progbar"></a></dt>
<dd><p>dummy for flagging if a progressbar should be produced during the call</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list consisting of the following:</p>
<dl><dt>out</dt>
<dd><p>A matrix with simulated draws from a model in standard form. Each row represents
one draw from the density</p></dd>

<dt>draws</dt>
<dd><p>A vector with the number of candidates required before
acceptance for each draw</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function uses the information contained in the constructed envelope list in order to sample
from a model in standard form. The simulation proceeds as follows in order to generate each draw in the required
number of samples.</p>
<p>1)  A random number between 0 and 1 is generated and is used together with the information in the PLSD vector
(from the envelope) in order to identify the part of the grid from which a candidate is to be generated.</p>
<p>2) For the part of the grid selected, the dimensions are looped through and a candidate component for each dimension
is generated from a restricted normal using information from the Envelope (in particular, the values for logrt, loglt,
and cbars corresponding to that the part of the grid selected and the dimension sampled)</p>
<p>3) The log-likelihood for the standardized model is evaluated for the generated candidate (note that the
log-likelihood here includes the portion of the prior that was shifted to the log-likelihood)</p>
<p>4) An additional random number is generated and the log of this random number is compared to a
 log-acceptance rate that is calculated based on the candidate and the LLconst component from the Envelope
 component selected in order to determine if the candidate should be accepted or rejected</p>
<p>5) If the candidate was not accepted, the process above is repeated from step 1 until a candidate is accepted</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">menarche2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">menarche2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Age            Total           Menarche      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Min.   : 9.21   Min.   :  88.0   Min.   :   0.00  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1st Qu.:11.58   1st Qu.:  98.0   1st Qu.:  10.00  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median :13.08   Median : 105.0   Median :  51.00  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mean   :13.10   Mean   : 156.7   Mean   :  92.32  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3rd Qu.:14.58   3rd Qu.: 117.0   3rd Qu.:  92.00  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Max.   :17.58   Max.   :1049.0   Max.   :1049.00  </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Menarche</span><span class="op">/</span><span class="va">Total</span> <span class="op">~</span> <span class="va">Age</span>, data<span class="op">=</span><span class="va">menarche2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="rnnorm_reg_std-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Age2</span><span class="op">=</span><span class="va">menarche2</span><span class="op">$</span><span class="va">Age</span><span class="op">-</span><span class="fl">13</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fl">1.0</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Age2</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">=</span><span class="va">Age2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">y</span><span class="op">=</span><span class="va">menarche2</span><span class="op">$</span><span class="va">Menarche</span><span class="op">/</span><span class="va">menarche2</span><span class="op">$</span><span class="va">Total</span></span></span>
<span class="r-in"><span><span class="va">wt</span><span class="op">=</span><span class="va">menarche2</span><span class="op">$</span><span class="va">Total</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mu</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fl">0.0</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">2</span>,ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mu</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">/</span><span class="fl">0.1</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">V1</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fl">2.0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2 standard deviations for prior estimate at age 13 between 0.1 and 0.9</span></span></span>
<span class="r-in"><span><span class="co">## Specifies uncertainty around the point estimates</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">V1</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">&lt;-</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">/</span><span class="fl">0.1</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> </span></span>
<span class="r-in"><span><span class="va">V1</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">=</span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="va">mu</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>  <span class="co"># Allows slope to be up to 1 times as large as point estimate </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#out&lt;-rglmb(n = 1000, y=y, x=x, mu=mu, P=solve(V1), wt = wt, </span></span></span>
<span class="r-in"><span><span class="co">#           family = binomial(logit), Gridtype = 3) </span></span></span>
<span class="r-in"><span><span class="co">#summary(out)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">famfunc</span><span class="op">&lt;-</span><span class="fu"><a href="glmbfamfunc.html">glmbfamfunc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="va">logit</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">f1</span><span class="op">&lt;-</span><span class="va">famfunc</span><span class="op">$</span><span class="va">f1</span></span></span>
<span class="r-in"><span><span class="va">f2</span><span class="op">&lt;-</span><span class="va">famfunc</span><span class="op">$</span><span class="va">f2</span>  <span class="co"># Used in optim and glmbsim_cpp</span></span></span>
<span class="r-in"><span><span class="va">f3</span><span class="op">&lt;-</span><span class="va">famfunc</span><span class="op">$</span><span class="va">f3</span>  <span class="co"># Used in optim</span></span></span>
<span class="r-in"><span><span class="va">f5</span><span class="op">&lt;-</span><span class="va">famfunc</span><span class="op">$</span><span class="va">f5</span></span></span>
<span class="r-in"><span><span class="va">f6</span><span class="op">&lt;-</span><span class="va">famfunc</span><span class="op">$</span><span class="va">f6</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dispersion2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fl">1.0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">start</span> <span class="op">&lt;-</span> <span class="va">mu</span></span></span>
<span class="r-in"><span><span class="va">offset2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fl">0.0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">P</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">V1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span><span class="op">=</span><span class="fl">1000</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###### Adjust weight for dispersion</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">wt2</span><span class="op">=</span><span class="va">wt</span><span class="op">/</span><span class="va">dispersion2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">######################### Shift mean vector to offset so that adjusted model has 0 mean</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">alpha</span><span class="op">=</span><span class="va">x</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">+</span><span class="va">offset2</span></span></span>
<span class="r-in"><span><span class="va">mu2</span><span class="op">=</span><span class="fl">0</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">P2</span><span class="op">=</span><span class="va">P</span></span></span>
<span class="r-in"><span><span class="va">x2</span><span class="op">=</span><span class="va">x</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#####  Optimization step to find posterior mode and associated Precision</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">parin</span><span class="op">=</span><span class="va">start</span><span class="op">-</span><span class="va">mu</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">opt_out</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span><span class="va">parin</span>,<span class="va">f2</span>,<span class="va">f3</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,mu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>              P<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>,wt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">wt2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>              method<span class="op">=</span><span class="st">"BFGS"</span>,hessian<span class="op">=</span><span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">bstar</span><span class="op">=</span><span class="va">opt_out</span><span class="op">$</span><span class="va">par</span>  <span class="co">## Posterior mode for adjusted model</span></span></span>
<span class="r-in"><span><span class="va">bstar</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -0.01069645</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  0.89698197</span>
<span class="r-in"><span><span class="va">bstar</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>  <span class="co"># mode for actual model</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -0.01069645</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  1.62939016</span>
<span class="r-in"><span><span class="va">A1</span><span class="op">=</span><span class="va">opt_out</span><span class="op">$</span><span class="va">hessian</span> <span class="co"># Approximate Precision at mode</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Standardize Model</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Standard_Mod</span><span class="op">=</span><span class="fu"><a href="glmb_Standardize_Model.html">glmb_Standardize_Model</a></span><span class="op">(</span>y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,P<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    bstar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">bstar</span>,ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, A1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">A1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">bstar2</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">bstar2</span>  </span></span>
<span class="r-in"><span><span class="va">A</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">A</span></span></span>
<span class="r-in"><span><span class="va">x2</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">x2</span></span></span>
<span class="r-in"><span><span class="va">mu2</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">mu2</span></span></span>
<span class="r-in"><span><span class="va">P2</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">P2</span></span></span>
<span class="r-in"><span><span class="va">L2Inv</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">L2Inv</span></span></span>
<span class="r-in"><span><span class="va">L3Inv</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">L3Inv</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Env2</span><span class="op">=</span><span class="fu"><a href="EnvelopeBuild.html">EnvelopeBuild</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">bstar2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span>,<span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">mu2</span>,ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">P2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">wt2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   family<span class="op">=</span><span class="st">"binomial"</span>,link<span class="op">=</span><span class="st">"logit"</span>,Gridtype<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                   n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,sortgrid<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## These now seem to match</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Env2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $GridIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   GIndex.Var1 GIndex.Var2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           2           2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6           3           2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8           2           3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           2           1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           1           2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9           3           3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           3           1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7           1           3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1           1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $thetabars</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     G3.Var1    G3.Var2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 0.5662049 0.11300265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 0.6195287 0.11300265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8 0.5662049 0.17044504</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.5662049 0.05556027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 0.5128810 0.11300265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9 0.6195287 0.17044504</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.6195287 0.05556027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 0.5128810 0.17044504</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.5128810 0.05556027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cbars</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       cbars.1     cbars.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  -0.5661981  -0.1130015</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  34.4621159  -0.2437098</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  -1.4475523  34.1689246</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  -1.4796882 -35.3623598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 -40.7542186  -0.2682291</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  33.3865305  32.4873204</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  33.8979746 -33.8580716</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 -41.3722300  35.7125259</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -42.1074002 -37.3119403</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $logU</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        logU.1      logU.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   -3.850428   -3.776049</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 -618.902574   -3.784589</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   -4.238723 -593.065539</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   -4.267555 -626.754407</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 -813.223858   -3.788093</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9 -581.745276 -536.732343</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -599.269541 -574.773949</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 -838.283187 -647.262791</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -868.590223 -697.486001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $logrt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        logrt.1      logrt.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   -0.6721049   -0.6704936</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 -618.9025745   -0.5738821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   -0.2008155 -593.0655394</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   -0.1906419    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    0.0000000   -0.5569172</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9 -581.7452759 -536.7323432</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -599.2695410    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7    0.0000000 -647.2627913</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    0.0000000    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $loglt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        loglt.1      loglt.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   -0.6720943   -0.6704918</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    0.0000000   -0.7778690</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   -1.6277922    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   -1.6735097 -626.7544071</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 -813.2238580   -0.7992502</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9    0.0000000    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    0.0000000 -574.7739490</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 -838.2831866    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -868.5902230 -697.4860009</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $LLconst</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 55.87862 35.14719 51.52363 59.36200 77.55426 31.17893 38.32546 72.77690</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [9] 81.36520</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $logP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]    -7.626477  -622.687163  -597.304262  -631.021962  -817.011951</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] -1118.477619 -1174.043490 -1485.545978 -1566.076224</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $PLSD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.24960979 0.13063173 0.12594361 0.12363622 0.11925255 0.06975357 0.06737136</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [8] 0.05788189 0.05591928</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $a1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 702.3746 605.1290</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#int n, NumericVector y, NumericMatrix x, NumericMatrix mu, NumericMatrix P, </span></span></span>
<span class="r-in"><span><span class="co">#NumericVector alpha, NumericVector wt, Function f2,</span></span></span>
<span class="r-in"><span><span class="co">#Rcpp::List Envelope, Rcpp::CharacterVector family, </span></span></span>
<span class="r-in"><span><span class="co">#Rcpp::CharacterVector link, int progbar</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Note: getting the types correct here is important but potentially difficult for users</span></span></span>
<span class="r-in"><span><span class="co">### May be better to call an R function wrapper that checks (and converts when possible) </span></span></span>
<span class="r-in"><span><span class="co">##  to correct types</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sim</span><span class="op">=</span><span class="fu">rnnorm_reg_std</span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>,mu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">mu2</span>,ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   P<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">P2</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>,wt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">wt2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   f2<span class="op">=</span><span class="va">f2</span>,Envelope<span class="op">=</span><span class="va">Env2</span>,family<span class="op">=</span><span class="st">"binomial"</span>,link<span class="op">=</span><span class="st">"logit"</span>,<span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out</span><span class="op">=</span><span class="va">L2Inv</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">L3Inv</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">out</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">=</span><span class="va">out</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">mu</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        V1                 V2       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Min.   :-0.19394   Min.   :1.421  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1st Qu.:-0.05347   1st Qu.:1.592  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median :-0.01173   Median :1.633  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mean   :-0.01080   Mean   :1.632  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3rd Qu.: 0.03219   3rd Qu.:1.672  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Max.   : 0.16937   Max.   :1.813  </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">draws</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.265</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Kjell Nygren.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

