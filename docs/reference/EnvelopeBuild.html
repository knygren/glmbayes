<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Builds Envelope function for simulation — EnvelopeBuild • glmbayes</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Builds Envelope function for simulation — EnvelopeBuild"><meta property="og:description" content="Builds an Enveloping function for simulation using a grid and tangencies for
the posterior density"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">glmbayes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/chapter-01.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-02.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-03.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-04.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-05.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-06.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-07.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-08.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-09.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-10.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-11.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-A1.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/Chapter-A2.html">UNKNOWN TITLE</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Builds Envelope function for simulation</h1>

    <div class="hidden name"><code>EnvelopeBuild.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Builds an Enveloping function for simulation using a grid and tangencies for
the posterior density</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">EnvelopeBuild</span><span class="op">(</span></span>
<span>  <span class="va">bStar</span>,</span>
<span>  <span class="va">A</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">mu</span>,</span>
<span>  <span class="va">P</span>,</span>
<span>  <span class="va">alpha</span>,</span>
<span>  <span class="va">wt</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"logit"</span>,</span>
<span>  Gridtype <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  sortgrid <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-bstar">bStar<a class="anchor" aria-label="anchor" href="#arg-bstar"></a></dt>
<dd><p>Point at which envelope should be centered (typically posterior mode</p></dd>


<dt id="arg-a">A<a class="anchor" aria-label="anchor" href="#arg-a"></a></dt>
<dd><p>Diagonal precision matrix for log-likelihood function associated with model in standard form</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>a vector of observations of length <code>m</code></p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>a design matrix of dimension <code>m * p</code></p></dd>


<dt id="arg-mu">mu<a class="anchor" aria-label="anchor" href="#arg-mu"></a></dt>
<dd><p>a vector giving the prior means of the variables</p></dd>


<dt id="arg-p">P<a class="anchor" aria-label="anchor" href="#arg-p"></a></dt>
<dd><p>a positive-definite symmetric matrix specifying the prior precision matrix of the variables</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>offset vector</p></dd>


<dt id="arg-wt">wt<a class="anchor" aria-label="anchor" href="#arg-wt"></a></dt>
<dd><p>a vector of weights</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>Family for the envelope. Can take on values binomial, quasibinomial, poisson, quasibinomial, and Gamma</p></dd>


<dt id="arg-link">link<a class="anchor" aria-label="anchor" href="#arg-link"></a></dt>
<dd><p>Link function for the envelope. Valid links for the binomial and quasibinomial families are logit, probit, and cloglog. The valid value for the poisson, quasipoisson, and the Gamma families is the log</p></dd>


<dt id="arg-gridtype">Gridtype<a class="anchor" aria-label="anchor" href="#arg-gridtype"></a></dt>
<dd><p>an optional argument specifying the method used to determine number of likelihood subgradient
densities used to construct the enveloping function</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>number of draws to generate from posterior density. Used here to help determine the size of the grid (Gridtype 1 and 2 only)</p></dd>


<dt id="arg-sortgrid">sortgrid<a class="anchor" aria-label="anchor" href="#arg-sortgrid"></a></dt>
<dd><p>an optional Logical argument determining whether the final envelope should be sorted in descending order based on probability for each part of the envelope</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>The function returns a list consisting of the following components (
the first six of which are matrices with the number of rows equal to the
number of components in the Grid and columns equal to the number of parameters):</p>
<dl><dt>GridIndex</dt>
<dd><p>A matrix containing information on how each dimension should be
sampled (1 means left tail of a restricted normal, 2 center, 3 right tail, and 4 the
entire line)</p></dd>

<dt>thetabars</dt>
<dd><p>A matrix containing the points of tangencies associated with each component of the grid</p></dd>

<dt>cbars</dt>
<dd><p>A matrix containing the gradients for the negative log-likelihood at each tangency</p></dd>

<dt>logU</dt>
<dd><p>A matrix containing the log of the cummulative probability associated with each dimension</p></dd>

<dt>logrt</dt>
<dd><p>A matrix containing the log of the probability associated with the right tail (i.e.
that to the right of the lower bound)</p></dd>

<dt>loglt</dt>
<dd><p>A matrix containing the log of the probability associated with the left tail (i.e.,
that to the left of the upper bound)</p></dd>

<dt>LLconst</dt>
<dd><p>A vector containing constant for each component of the grid used during the accept-reject procedure</p></dd>

<dt>logP</dt>
<dd><p>A matrix containing log-probabilities related to the components of the grid</p></dd>

<dt>PLSD</dt>
<dd><p>A vector containing the probability of each component in the Grid</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>To construct an enveloping function, we follow the approach in Nygren and Nygren (2006)
which involves the following steps when a maximally sized grid is constructed
(if the prior for some dimensions is relatively strong, this may not be needed)</p>

<p>1) For each dimension, a constant <code>omega_i</code> is found that depends on the
corresponding diagonal element in the precision matrix.</p>

<p>2) Corresponding intervals <code>(thetastar_i-0.5 *omega,thetastar_i-0.5 *omega)</code>
 are constructed around the posterior mode thetastar for each dimension</p>

<p>3) The mode as well as the points <code>thetastar_i-omega_i</code> and <code>thetastar_i+omega_i</code>
are selected as the components of the points at which tangencies will be found for each of
the dimensions.</p>

<p>4) A Grid is constructed with all possible combinations of points and
negative log-likelihood and gradient for the negative log-likelihood are evaluated (see the
EnvelopeBuild_c.cpp function source code for details)</p>

<p>5) The <code><a href="Set_Grid.html">Set_Grid</a></code> function is called in order to evaluate the log of the density associated
with each of the resulting restricted multivariate normals by evaluating the differences between the cummulative
density for each dimension between its lower and upper bound.</p>

<p>6)  The Set_LogP is called in order to help set the probabilities with which each of the components
of the grid should be sampled (see remark 6 in Nygren and Nygren (2006)).</p>

<p>Any constants needed by the sampling are added to a list and returned by the function.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">menarche2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">menarche2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Age            Total           Menarche      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Min.   : 9.21   Min.   :  88.0   Min.   :   0.00  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1st Qu.:11.58   1st Qu.:  98.0   1st Qu.:  10.00  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median :13.08   Median : 105.0   Median :  51.00  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mean   :13.10   Mean   : 156.7   Mean   :  92.32  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3rd Qu.:14.58   3rd Qu.: 117.0   3rd Qu.:  92.00  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Max.   :17.58   Max.   :1049.0   Max.   :1049.00  </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Menarche</span><span class="op">/</span><span class="va">Total</span> <span class="op">~</span> <span class="va">Age</span>, data<span class="op">=</span><span class="va">menarche2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="EnvelopeBuild-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Age2</span><span class="op">=</span><span class="va">menarche2</span><span class="op">$</span><span class="va">Age</span><span class="op">-</span><span class="fl">13</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fl">1.0</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Age2</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">=</span><span class="va">Age2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">y</span><span class="op">=</span><span class="va">menarche2</span><span class="op">$</span><span class="va">Menarche</span><span class="op">/</span><span class="va">menarche2</span><span class="op">$</span><span class="va">Total</span></span></span>
<span class="r-in"><span><span class="va">wt</span><span class="op">=</span><span class="va">menarche2</span><span class="op">$</span><span class="va">Total</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mu</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fl">0.0</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">2</span>,ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mu</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">/</span><span class="fl">0.1</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">V1</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fl">2.0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2 standard deviations for prior estimate at age 13 between 0.1 and 0.9</span></span></span>
<span class="r-in"><span><span class="co">## Specifies uncertainty around the point estimates</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">V1</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">&lt;-</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.9</span><span class="op">/</span><span class="fl">0.1</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">/</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> </span></span>
<span class="r-in"><span><span class="va">V1</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">=</span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="va">mu</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>  <span class="co"># Allows slope to be up to 1 times as large as point estimate </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">famfunc</span><span class="op">&lt;-</span><span class="fu"><a href="glmbfamfunc.html">glmbfamfunc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="va">logit</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">f1</span><span class="op">&lt;-</span><span class="va">famfunc</span><span class="op">$</span><span class="va">f1</span></span></span>
<span class="r-in"><span><span class="va">f2</span><span class="op">&lt;-</span><span class="va">famfunc</span><span class="op">$</span><span class="va">f2</span></span></span>
<span class="r-in"><span><span class="va">f3</span><span class="op">&lt;-</span><span class="va">famfunc</span><span class="op">$</span><span class="va">f3</span></span></span>
<span class="r-in"><span><span class="va">f5</span><span class="op">&lt;-</span><span class="va">famfunc</span><span class="op">$</span><span class="va">f5</span></span></span>
<span class="r-in"><span><span class="va">f6</span><span class="op">&lt;-</span><span class="va">famfunc</span><span class="op">$</span><span class="va">f6</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dispersion2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fl">1.0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">start</span> <span class="op">&lt;-</span> <span class="va">mu</span></span></span>
<span class="r-in"><span><span class="va">offset2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fl">0.0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">P</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">V1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span><span class="op">=</span><span class="fl">1000</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###### Adjust weight for dispersion</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">wt2</span><span class="op">=</span><span class="va">wt</span><span class="op">/</span><span class="va">dispersion2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">######################### Shift mean vector to offset so that adjusted model has 0 mean</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">alpha</span><span class="op">=</span><span class="va">x</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">+</span><span class="va">offset2</span></span></span>
<span class="r-in"><span><span class="va">mu2</span><span class="op">=</span><span class="fl">0</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">P2</span><span class="op">=</span><span class="va">P</span></span></span>
<span class="r-in"><span><span class="va">x2</span><span class="op">=</span><span class="va">x</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#####  Optimization step to find posterior mode and associated Precision</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">parin</span><span class="op">=</span><span class="va">start</span><span class="op">-</span><span class="va">mu</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">opt_out</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span><span class="va">parin</span>,<span class="va">f2</span>,<span class="va">f3</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,mu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>              P<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>,wt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">wt2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>              method<span class="op">=</span><span class="st">"BFGS"</span>,hessian<span class="op">=</span><span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">bstar</span><span class="op">=</span><span class="va">opt_out</span><span class="op">$</span><span class="va">par</span>  <span class="co">## Posterior mode for adjusted model</span></span></span>
<span class="r-in"><span><span class="va">bstar</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -0.01069645</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  0.89698197</span>
<span class="r-in"><span><span class="va">bstar</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>  <span class="co"># mode for actual model</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -0.01069645</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  1.62939016</span>
<span class="r-in"><span><span class="va">A1</span><span class="op">=</span><span class="va">opt_out</span><span class="op">$</span><span class="va">hessian</span> <span class="co"># Approximate Precision at mode</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Standardize Model</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Standard_Mod</span><span class="op">=</span><span class="fu"><a href="glmb_Standardize_Model.html">glmb_Standardize_Model</a></span><span class="op">(</span>y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,P<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    bstar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">bstar</span>,ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, A1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">A1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">bstar2</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">bstar2</span>  </span></span>
<span class="r-in"><span><span class="va">A</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">A</span></span></span>
<span class="r-in"><span><span class="va">x2</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">x2</span></span></span>
<span class="r-in"><span><span class="va">mu2</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">mu2</span></span></span>
<span class="r-in"><span><span class="va">P2</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">P2</span></span></span>
<span class="r-in"><span><span class="va">L2Inv</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">L2Inv</span></span></span>
<span class="r-in"><span><span class="va">L3Inv</span><span class="op">=</span><span class="va">Standard_Mod</span><span class="op">$</span><span class="va">L3Inv</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Env2</span><span class="op">=</span><span class="fu">EnvelopeBuild</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">bstar2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span>,<span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">mu2</span>,ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">P2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">wt2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>family<span class="op">=</span><span class="st">"binomial"</span>,link<span class="op">=</span><span class="st">"logit"</span>,Gridtype<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>sortgrid<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## These now seem to match</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Env2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $GridIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   GIndex.Var1 GIndex.Var2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           2           2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6           3           2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8           2           3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           2           1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           1           2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9           3           3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           3           1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7           1           3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1           1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $thetabars</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     G3.Var1    G3.Var2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 0.5662049 0.11300265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 0.6195287 0.11300265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8 0.5662049 0.17044504</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.5662049 0.05556027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 0.5128810 0.11300265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9 0.6195287 0.17044504</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.6195287 0.05556027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 0.5128810 0.17044504</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.5128810 0.05556027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cbars</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       cbars.1     cbars.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  -0.5661981  -0.1130015</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  34.4621159  -0.2437098</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  -1.4475523  34.1689246</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  -1.4796882 -35.3623598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 -40.7542186  -0.2682291</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  33.3865305  32.4873204</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  33.8979746 -33.8580716</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 -41.3722300  35.7125259</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -42.1074002 -37.3119403</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $logU</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        logU.1      logU.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   -3.850428   -3.776049</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 -618.902574   -3.784589</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   -4.238723 -593.065539</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   -4.267555 -626.754407</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 -813.223858   -3.788093</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9 -581.745276 -536.732343</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -599.269541 -574.773949</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 -838.283187 -647.262791</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -868.590223 -697.486001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $logrt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        logrt.1      logrt.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   -0.6721049   -0.6704936</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 -618.9025745   -0.5738821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   -0.2008155 -593.0655394</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   -0.1906419    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    0.0000000   -0.5569172</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9 -581.7452759 -536.7323432</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -599.2695410    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7    0.0000000 -647.2627913</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    0.0000000    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $loglt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        loglt.1      loglt.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   -0.6720943   -0.6704918</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    0.0000000   -0.7778690</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   -1.6277922    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   -1.6735097 -626.7544071</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 -813.2238580   -0.7992502</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9    0.0000000    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    0.0000000 -574.7739490</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 -838.2831866    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -868.5902230 -697.4860009</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $LLconst</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 55.87862 35.14719 51.52363 59.36200 77.55426 31.17893 38.32546 72.77690</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [9] 81.36520</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $logP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]    -7.626477  -622.687163  -597.304262  -631.021962  -817.011951</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] -1118.477619 -1174.043490 -1485.545978 -1566.076224</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $PLSD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.24960979 0.13063173 0.12594361 0.12363622 0.11925255 0.06975357 0.06737136</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [8] 0.05788189 0.05591928</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $a1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 702.3746 605.1290</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Kjell Nygren.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

